#!/usr/bin/env python

import os
import sys
import doctest

current_path = os.path.abspath(os.path.dirname(__file__))
os.chdir(current_path)
sep = os.sep

def main():
    """Main test routine for BookSearch"""

    for filename in os.listdir(current_path + sep + 'metadata'):
        print "* " + filename
        if filename.find('.swp') > -1:
            continue 
        target = os.path.relpath(current_path + sep + 'metadata' + sep + filename, current_path)
        with open(target, 'r') as test_fh:
            test_name = test_fh.readline().strip()

        print "Testing %s" % test_name
        doctest_result = doctest.testfile(target, report=False, verbose=False)
        if doctest_result.failed == 0:
            print "\t Test ok!"
        else:
            print "\t Test failed\n\t %s" % doctest_result.__str__()
            print "To debug: python -m doctest %s" % "librarysearch" + sep + "testsuite" + sep + target
            sys.exit(-1)


"""

                                       [35;22m_[35;22m_[35;22m_[35;22m.[35;22m.[35;22m.[35;22m-[35;22m-[35;22m-[35;22m-[35;22m.[35;22m.                
                                 [35;22m.[35;22m.[35;22m'[35;22m'[35;22m`[35;22m`         [34;1mx  [35;22m`[35;22m.              
                                [35;22m/   [34;1m*       [36;1mx        [35;22m`[35;22m.            
                               [35;22m|   [35;22m\[35;22m_[35;22m\[35;22m_[35;22m\         [37;1m.  [36;1mX  [35;22m\           
                               [35;22m:  [35;22m.[35;22m'    [35;22m'[35;22m.  [34;1m*   [37;1m`[37;1mX[37;1m'     [35;22m|          
                               [35;22ml [35;22m/       [35;22m'[35;22m.     [37;1m' [37;1m`     [35;22m.          
                                [35;22mV         [35;22m|   [36;1m*     [36;1m.   [35;22m|          
                                          [35;22m|        [36;1m`[36;1mX[36;1m'  [35;22m|[35;22m.         
                                     [35;22m_[35;22m.[35;22m.[35;22m-[35;22m-[35;22mj   [34;1mX    [36;1m' [36;1m`  [35;22m` [35;22m`[35;22m'[35;22m'[35;22m-[35;22m-[35;22m.[35;22m.[35;22m. 
                                   [35;22m<[35;22m'[35;22m_[35;22m_  [36;1m*           [37;1mx      [37;1m*    [35;22m.[35;22m>
                                      [36;1m/[35;22m`[35;22m`[35;22m'[35;22m'[35;22m'[35;22m-[35;22m-[35;22m-[35;22m-[35;22m_[35;22m_[35;22m_[35;22m_      [35;22m_[35;22m_[35;22m_[35;22m.[35;22m.[35;22m'[35;22m'  
                                     [36;1m(   [34;1m\[34;1m_  [37;22m(   [35;22m/[30;1m.[30;1m-[35;22m`[37;22m|[35;22m'[37;22m|[35;22m`[35;22m'[37;22m| [36;1m.[36;1m'   [36;1m| 
                                     [36;1m(     [36;1m\[37;22m,[37;22m'[37;22m\ [35;22m([30;1m([30;1mW[30;1mW [37;22m| [37;22m\[30;1mW[35;22m)[37;22mj [36;1m|   [36;1m/ [36;1m.
          [36;1m.[36;1m.[36;1m-[36;1m-[36;1m-[36;1m'[36;1m'[36;1m'[36;1m'[36;1m'[36;1m-[36;1m-[36;1m-              [36;1m(      [36;1m|  [37;22m\[37;22m_[35;22m\[37;22m_ [37;22m/   [34;1m`[34;1m`[34;1m-[34;1m.[36;1m:  [36;1m:[36;1m_[36;1m/[36;1m|
        [36;1m,[36;1m'             [36;1m`[36;1m'[36;1m.           [36;1m(      [36;1m|          [34;1m\[34;1m_[34;1m_[34;1m/  [36;1m`[36;1m-[36;1m-[36;1m-[36;1m' 
       [36;1m/   [36;1m_              [36;1m'[36;1m.          [36;1m\     [36;1m'[36;1m. [34;1m-[34;1m,[34;1m_[34;1m_[34;1m_[34;1m_[34;1m_[34;1m_[34;1m.[34;1m-[34;1m'         
      [36;1m| [36;1m.[36;1m-[36;1m'[36;1m/                [36;1m:[34;1m_[34;1m_[34;1m_[34;1m_[34;1m_[34;1m_[34;1m_[34;1m_[34;1m_[34;1m_[36;1m`[36;1m.    [36;1m|    [34;1m/                
      [36;1m'[36;1m`  [36;1m-          [36;1m.[36;1m-[36;1m'[36;1m'[36;1m>[36;1m-[36;1m'             [36;1m\   [36;1m'[36;1m.  [34;1m(                 
          [36;1m|         [36;1m/   [34;1m/  [36;1m. [37;1m.            [36;1m'[36;1m.  [36;1m'[36;1m.  [34;1m\                
          [36;1m|         [36;1m|  [34;1m|  [36;1m/[36;1m|[37;1m`[37;1mX[37;1m'        [36;1m'[36;1m:[36;1m-[36;1m.[36;1m_[36;1m)  [36;1m|   [34;1m|               
         [36;1m.[36;1m'         [36;1m|  [34;1m| [36;1m( [36;1m:[37;1m'[37;22m|[37;1m`          [36;1m`[36;1m-[36;1m_[36;1m_[36;1m_[36;1m.[36;1m'   [34;1m|               
         [36;1m|          [36;1m|  [34;1m|  [36;1m\ [36;1m`[37;22m|[36;1m>                    [34;1m|               
         [36;1m|          [36;1m| [34;1m/ [34;1m\  [36;1m`[36;1m`[37;22m'   [34;1m/             [34;1m\[34;1m_[34;1m_[34;1m/                
         [36;1m'[36;1m.        [36;1m.[36;1m'[34;1m'   [34;1m|      [34;1m/[34;1m-[34;1m,[34;1m_[34;1m_[34;1m_[34;1m_[34;1m_[34;1m_[34;1m_[34;1m\       [34;1m\                
          [36;1m|        [36;1m|   [34;1m_[34;1m/      [34;1m/     [34;1m|    [34;1m|[34;1m\       [34;1m\               
          [36;1m|        [36;1m|  [34;1m/       [34;1m/     [34;1m|     [34;1m| [34;1m`[34;1m-[34;1m-[34;1m,    [34;1m\              
         [36;1m.[36;1m'       [36;1m:   [34;1m|      [34;1m|      [34;1m|     [34;1m|   [34;1m/      [34;1ml             
   [36;1m.[36;1m_[36;1m_[36;1m.[36;1m.[36;1m'    [36;1m,   [36;1m:[34;1m\[34;1m_[34;1m_[34;1m/[34;1m|      [34;1m|      [34;1m|      [34;1m| [34;1m(       [34;1m|             
    [36;1m`[36;1m-[36;1m.[36;1m_[36;1m_[36;1m_[36;1m.[36;1m-[36;1m`[36;1m;  [36;1m/     [34;1m|      [34;1m|      [34;1m|      [34;1m|  [34;1m\      [34;1m|             
           [36;1m.[36;1m:[36;1m_[36;1m-[36;1m'      [34;1m|       [34;1m\     [34;1m|       [34;1m\  [34;1m`[34;1m.[34;1m_[34;1m_[34;1m_[34;1m/              
                       [34;1m\[34;1m_[34;1m_[34;1m_[34;1m_[34;1m_[34;1m_[34;1m_[34;1m)     [34;1m\[34;1m_[34;1m_[34;1m_[34;1m_[34;1m_[34;1m_[34;1m_[34;1m)                     
                                                                   
                                                                   
                                                                   
[0m
"""
